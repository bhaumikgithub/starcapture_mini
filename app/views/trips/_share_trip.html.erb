<div class="main-content d-inline-block align-top">
  <div class="row m-0">
    <div class="col-12 p-0">
      <nav class="navbar navbar-expand-lg navbar-light bg-light custom-navbar">
        <p class="navbar-brand mb-0">
          <label id="title" style="margin-bottom:0px;"><%= @trip.name %></label>
          <span id="head_desc" class="d-block"><%= @trip.description %></span>
        </p>
      </nav>
    </div>
  </div>
  <div class="row m-0 trip_schedules">
    <div class="col-12 p-0">
      <div id="wrapper">
        <div id="sidebar-wrapper">
          <div id="destination-stop-wrapper" class="list-group pointer-none user-select-none">
            <!-- map result table header -->
            <div class="row m-0 map-result-head-row">
                <div class="col-sm-12 d-table w-100 map-result-tbl pl-0">
                  <div class='text-white d-table-cell result-cell'>
                    Start Time
                  </div>

                  <div class='ml-1 text-white d-table-cell result-cell'>
                   End Time
                  </div>

                  <div class='ml-1 text-white d-table-cell result-cell'>
                    Place
                  </div>

                  <div class='ml-1 text-white d-table-cell result-cell'>
                    Total K/m
                  </div>
                </div>  
              </div>
            <!-- map result table header  -->
            <%  @trip.trip_schedules.each do |trip_schedule|%>
              <div class="row m-0">
                <div class="col-sm-12 d-table w-100 map-result-tbl pl-0">
                  <div class='text-white d-table-cell result-cell'>
                    <%= trip_schedule&.start_time&.strftime('%H:%M') %> -
                  </div>

                  <div class='ml-1 text-white d-table-cell result-cell'>
                    <%= trip_schedule&.end_time&.strftime('%H:%M') %>
                  </div>

                  <div class='ml-1 text-white d-table-cell result-cell'>
                    <%= trip_schedule.place %>
                  </div>

                  <div class='ml-1 text-white d-table-cell result-cell'>
                    <%= trip_schedule.distance %> kms
                  </div>
                </div>  
              </div>
            <% end %>
          </div>
          <div class="ml-3 text-white">
            <span class='total_display'></span>
          </div>
        </div>
        <div id="page-content-wrapper">
          <a href class="btn btn-primary route-sidebarmenu" data-toggle="sidebar">
            <i class="fa fa-chevron-right"> </i>
          </a>
          <div class="row h-100 m-0">
            <div class="col-12 h-100 p-0">
              <div class="map-wrap h-100">
                <div id="map"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
  $(document).ready(function(){  
    var clipboard = new Clipboard('.clipboard-btn');
    initMap()
    getPlaces()
  });
  $('[data-toggle="sidebar"]').click(function (e) {
  e.preventDefault();
  $("#wrapper").toggleClass("toggled");
  if ($("#wrapper").hasClass("toggled")) {
    $(this).find("i").removeClass("fa-chevron-right").addClass("fa-chevron-left");
  } else {
    $(this).find("i").removeClass("fa-chevron-left").addClass("fa-chevron-right");
  }
});
  $(document).keypress(
  function(event){
    if (event.which == '13') {
      event.preventDefault();
    }
});
  $('.share').click(function(e){
    var db_data_lenght = '<%= @trip.trip_schedules.length %>'
    var total_length = $('.place_search').length
    if(total_length > db_data_lenght){
      alert('Please save before share it.')
      return false
    }
    if(total_length < db_data_lenght){
      alert('Please save before share it.')
      return false
    }
  })

  $(function() {
    var sortIndex = {};
    $( "#destination-stop-wrapper" ).sortable({
      start: function(e, ui) {
      },
      update: function(e, ui) {
        $( "#destination-stop-wrapper" ).find('.start_time').each(function(index){
          if(this.id){
            sortIndex[index] = this.id
          }
        });
        if(Object.keys(sortIndex).length > 0){
          var request = $.ajax({
            url: "<%= params[:id].present? ? trip_path(params[:id]) : ''%>",
            type: "PUT",
            data: {data: sortIndex},
            dataType: "html"
          });
        }
        getDirection()
      }
    })
  });
</script>  
